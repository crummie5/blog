<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Crummie5</title>
        <link>https://www.crummie5.club</link>
        <description>Just a crummy blog. Talking about Active Directory, Windows, Linux, Web and General Hacking.</description>
        <generator>Zola</generator>
        <language>en</language>
        <atom:link href="https://www.crummie5.club/rss.xml" rel="self" type="application/rss+xml"/>
        <lastBuildDate>Wed, 10 Jun 2020 00:00:00 +0000</lastBuildDate>
        
            <item>
                <title>FreshyCalls: Syscalls Freshly Squeezed!</title>
                <pubDate>Wed, 10 Jun 2020 00:00:00 +0000</pubDate>
                <link>https://www.crummie5.club/freshycalls/</link>
                <guid>https://www.crummie5.club/freshycalls/</guid>
                <description>&lt;p&gt;These last months I&#x27;ve been familiarizing myself with Windows syscalls: how they work, their offensive usage and potential detections from the blue side. Although the theory was quite interesting, I had to get my hands on it. &lt;&#x2F;p&gt;
&lt;p&gt;I started with the basics: static syscalls for my version of Windows. &lt;&#x2F;p&gt;
&lt;p&gt;As I&#x27;m not a pentester - I&#x27;m a programmer - I found it too uncomfortable to have to define each syscall each time. That&#x27;s why I made a list with all the syscall numbers and a template that mapped each syscall with each number in a global variable. &lt;&#x2F;p&gt;
&lt;p&gt;It was something like this:&lt;&#x2F;p&gt;
&lt;p&gt;syscall.asm:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b2c2f;&quot;&gt;
&lt;span style=&quot;color:#6699cc;&quot;&gt;EXTERN syscall_no:DWORD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;.code&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;call_syscall PROC&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;mov &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;r10&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;rcx&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;mov &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;eax&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;syscall_no&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;syscall&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;ret&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;call_syscall ENDP&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;END&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;syscall.cpp:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b2c2f;&quot;&gt;
&lt;span style=&quot;color:#c594c5;&quot;&gt;extern &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;C&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;DWORD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt; syscall_no &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;
extern &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;C&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c594c5;&quot;&gt;void&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;call_syscall&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(...);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;[...]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fac863;&quot;&gt;DWORD&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt; syscall_no &lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt; syscalls&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;find&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#99c794;&quot;&gt;NtReadVirtualMemory&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;&amp;quot;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;call_syscall&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;h_process&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt; mem_addr&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;, &amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt;buf&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#6699cc;&quot;&gt; mem_size&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f99157;&quot;&gt;nullptr&lt;&#x2F;span&gt;&lt;span style=&quot;color:#5fb3b3;&quot;&gt;);&lt;&#x2F;span&gt;&lt;span style=&quot;color:#cccece;&quot;&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;pre&gt;</description>
            </item>
        
            <item>
                <title>Kerberos Unconstrained Delegation: Compromising a Computer Object by its TGT</title>
                <pubDate>Sun, 12 Apr 2020 00:00:00 +0000</pubDate>
                <link>https://www.crummie5.club/kerberos-unconstrained-tgt/</link>
                <guid>https://www.crummie5.club/kerberos-unconstrained-tgt/</guid>
                <description>&lt;p&gt;Everything that involves Kerberos functionality is such a complex subject… since I’ve been abusing these attack chains a lot recently, I thought this post would be helpful to someone.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;NOTE:&lt;&#x2F;strong&gt; Nothing explained here is new at all. If you understand how Delegations work you may be already aware of these vectors. Nonetheless it might not be as straight forward for everyone, hence I’m writing this.&lt;&#x2F;p&gt;
&lt;p&gt;If you are not familiar with Kerberos Delegation, you can find some links in the References section as I don’t feel necessary to explain what is already perfectly explained by others.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;a class=&quot;zola-anchor&quot; href=&quot;#introduction&quot; aria-label=&quot;Anchor link for: introduction&quot;&gt;
    &lt;svg id=&quot;i-link&quot; xmlns=&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot; viewBox=&quot;0 0 32 32&quot; width=&quot;32&quot; height=&quot;32&quot; fill=&quot;none&quot;
        stroke=&quot;currentcolor&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot;&gt;
        &lt;path
            d=&quot;M18 8 C18 8 24 2 27 5 30 8 29 12 24 16 19 20 16 21 14 17 M14 24 C14 24 8 30 5 27 2 24 3 20 8 16 13 12 16 11 18 15&quot;&gt;
        &lt;&#x2F;path&gt;
    &lt;&#x2F;svg&gt;
&lt;&#x2F;a&gt;
&lt;&#x2F;h2&gt;
&lt;p&gt;Ok let’s asume we&#x27;ve compromised &lt;code&gt;Web01.capsule.corp&lt;&#x2F;code&gt;, a server with Kerberos Unconstrained Delegation enabled:&lt;&#x2F;p&gt;
&lt;figure&gt;
  &lt;img src=&quot;https:&#x2F;&#x2F;www.crummie5.club&#x2F;kerberos-unconstrained-tgt&#x2F;&#x2F;fig1.png&quot; alt=&quot;Web01 configured with Unconstrained Delegation.&quot; &#x2F;&gt;
  &lt;figcaption&gt;Web01 configured with Unconstrained Delegation.&lt;&#x2F;figcaption&gt;
&lt;&#x2F;figure&gt;
</description>
            </item>
        
            <item>
                <title>Pwning A Pwned Citrix</title>
                <pubDate>Sun, 19 Jan 2020 00:00:00 +0000</pubDate>
                <link>https://www.crummie5.club/pwning-a-pwned-citrix/</link>
                <guid>https://www.crummie5.club/pwning-a-pwned-citrix/</guid>
                <description>&lt;p&gt;&lt;strong&gt;Hello H4x0rs!&lt;&#x2F;strong&gt;
At this time you surely have heard about the new and dangerous Citrix vulnerability labeled as CVE-2019-19781, consisting in a Directory Traversal plus Remote Command Execution attack vector. During a real security engagement I had to face a peculiar situation related to this and I wanted to share it with you, hope you find it useful.&lt;&#x2F;p&gt;
&lt;p&gt;Just as a quick recap, CVE-2019-19781, also known as “Shitrix” takes advantage of how the Citrix Gateway appliance handles templates. You can create a template by making a call to the &lt;code&gt;&#x2F;vpn&#x2F;..&#x2F;vpns&#x2F;portal&#x2F;scripts&#x2F;newbm.pl&lt;&#x2F;code&gt; endpoint and inserting some Perl template into an XML file. This one contains the payload, but it is not executed until a request is made to the &lt;code&gt;&#x2F;vpn&#x2F;..&#x2F;vpns&#x2F;portal&#x2F;&amp;lt;xml_name&amp;gt;.xml&lt;&#x2F;code&gt; endpoint, which is the action that triggers the command execution.&lt;&#x2F;p&gt;
&lt;p&gt;There are a few exploits available to the public that implements that process so that you only have to specify the target and press enter to get a shell. However none of these worked for me for a good reason that we are going to explore in the following lines.&lt;&#x2F;p&gt;
</description>
            </item>
        
    </channel>
</rss>
